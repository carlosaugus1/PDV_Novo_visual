<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV Revvo Milk</title>
    <link rel="icon" href="image/Icoacaidaserra.ico">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

    <div id="login-overlay" class="login-overlay">
        <div class="login-box">
            <div class="brand-login">
                <img src="image/acaidaserra.png" alt="Logo" style="height: 80px; margin-bottom: 10px;">
                <h2>Acesso ao Sistema</h2>
            </div>
            <form id="system-login-form">
                <input type="text" id="sys-user" class="input-modern" placeholder="Usu√°rio" required>
                <input type="password" id="sys-password" class="input-modern" placeholder="Senha" required>
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px; font-size: 0.9rem; color: #555;">
                    <input type="checkbox" id="remember-me" style="width: auto; margin: 0;">
                    <label for="remember-me" style="cursor: pointer;">Lembrar de mim</label>
                </div>
                <button type="submit" class="btn-main">ENTRAR</button>
            </form>
            <div style="margin-top: 15px; text-align: center;">
                <a href="suporte.html" target="_blank" class="forgot-pass-link">Esqueci a senha / Suporte</a>
            </div>
        </div>
    </div>

    <aside class="sidebar">
        <div class="brand">
            <img src="image/acaidaserra.png" alt="Logo" class="brand-logo">
        </div>
        <nav class="nav-menu">
            <a href="#" class="nav-item active" data-tab="venda">üõí <span>Venda</span></a>
            <a href="#" class="nav-item" data-tab="produtos">üç¶ <span>Produtos</span></a>
            <a href="#" class="nav-item" data-tab="comandas">üìã <span>Comandas</span> <span class="badge" id="open-orders-count" style="display:none;">0</span></a>
            <a href="#" class="nav-item" data-tab="historico">üìú <span>Hist√≥rico</span></a>
            <a href="#" class="nav-item" data-tab="despesas">üí∏ <span>Despesas</span></a>
            <a href="#" class="nav-item" data-tab="admin" style="margin-top: auto;">‚öôÔ∏è <span>Admin</span></a>
        </nav>
    </aside>

    <main class="main-content">
        <header class="top-bar">
            <div class="page-info"><h2 id="page-title">Nova Venda</h2></div>
            <div class="current-date" id="current-date">--/--/----</div>
        </header>

        <div class="content-wrapper">

            <div id="venda-tab" class="tab-pane active">
                <div class="pos-layout">
                    <div class="pos-left">
                        <div id="discount-balloon" style="display: none; background: #FFF9C4; color: #FBC02D; padding: 15px; border-radius: 12px; margin-bottom: 20px; font-weight: bold; align-items: center; gap: 10px;">
                            <span>üéâ</span> <span id="discount-details">Promo√ß√£o Ativa!</span>
                        </div>
                        
                        <div id="edit-mode-bar" style="display: none; background: var(--primary-light); color: white; padding: 10px; border-radius: 12px; margin-bottom: 15px; justify-content: space-between; align-items: center;">
                            <span>‚úèÔ∏è Editando: <strong><span id="edit-mode-name"></span></strong></span>
                            <button id="cancel-edit-mode" style="background: rgba(0,0,0,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Cancelar</button>
                        </div>

                        <div class="card">
                            <div class="scale-header">
                                <h3>Pesagem</h3>
                                <div class="price-tag">R$ <span id="weighted-product-price-display">0.00</span>/kg</div>
                            </div>
                            <div class="type-selector">
                                <div class="type-btn active" data-type="acai">
                                    <img src="image/acai.png" alt="A√ßa√≠"><span>A√ßa√≠</span>
                                </div>
                                <div class="type-btn" data-type="sorvete">
                                    <img src="image/sorvete.png" alt="Sorvete"><span>Sorvete</span>
                                </div>
                            </div>
                            <div class="weight-wrapper">
                                <input type="number" id="weight-input" class="big-input" placeholder="0g">
                                <button id="add-to-cart" class="add-btn">+</button>
                            </div>
                            <div style="text-align: right; color: var(--text-light);">Valor: <strong>R$ <span id="calculated-price">0.00</span></strong></div>
                        </div>

                        <div class="card">
                            <h3>Adicionais R√°pidos</h3>
                            <div class="quick-add-container" id="quick-add-wrapper"></div>
                        </div>
                    </div>

                    <div class="cart-area">
                        <div class="card cart-container">
                            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                                <h3>Carrinho</h3>
                                <div class="delivery-switch">
                                    <button class="toggle-btn active" data-mode="balcao">üè™ Balc√£o</button>
                                    <button class="toggle-btn" data-mode="entrega">üõµ Entrega</button>
                                </div>
                            </div>

                            <div id="delivery-info-section" style="display: none; margin-bottom: 15px;">
                                <input type="text" id="delivery-customer-name" class="input-modern" placeholder="Nome do Cliente">
                                <input type="text" id="delivery-customer-address" class="input-modern" placeholder="Endere√ßo Completo">
                                <input type="number" id="delivery-fee" class="input-modern" placeholder="Taxa de Entrega (R$)">
                            </div>

                            <div class="cart-list" id="cart-items"></div>

                            <div class="cart-footer">
                                <div style="display:flex; justify-content:space-between; color:var(--text-light);"><span>Subtotal</span> <span id="subtotal">R$ 0,00</span></div>
                                <div class="totals-final"><span>Total</span> <span id="total">R$ 0,00</span></div>

                                <div id="pre-payment-actions">
                                    <button id="finish-sale" class="btn-main">FINALIZAR VENDA</button>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                        <button id="hold-sale" class="btn-sec">‚è≥ Pendurar / Salvar</button>
                                        <button id="cancel-sale" class="btn-sec" style="color:var(--danger); border-color:var(--danger);">‚úï Cancelar</button>
                                    </div>
                                </div>

                                <div id="payment-section" style="display: none;">
                                    <div class="payment-grid" id="main-payment-options">
                                        <div class="pay-opt" data-method="cash"><span>üíµ</span> Dinheiro</div>
                                        <div class="pay-opt" data-method="card"><span>üí≥</span> Cart√£o</div>
                                        <div class="pay-opt" data-method="pix"><span>üí†</span> PIX</div>
                                    </div>
                                    
                                    <div id="cash-input" style="display: none; margin-bottom: 10px;">
                                        <input type="number" id="cash-received" class="input-modern" placeholder="Valor Recebido (R$)">
                                        <div style="color:var(--accent-hover); font-weight:bold; text-align:right;">Troco: R$ <span id="change-amount">0.00</span></div>
                                    </div>

                                    <button id="confirm-payment" class="btn-main" style="background: var(--accent);">CONFIRMAR E IMPRIMIR</button>
                                    <button id="back-to-cart" class="btn-sec" style="width:100%; margin-top:10px;">Voltar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="produtos-tab" class="tab-pane">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                        <h3>Cat√°logo de Produtos</h3>
                        <div style="display:flex; gap:10px;">
                             <input type="search" id="product-search" class="input-modern" placeholder="üîç Buscar..." style="width: 200px; margin-bottom:0;">
                             <button id="btn-open-add-prod" class="btn-sec" style="background:var(--primary); color:white; border:none;">+ Novo</button>
                        </div>
                    </div>
                    <div class="product-grid" id="products-grid"></div>
                </div>
            </div>

            <div id="comandas-tab" class="tab-pane">
                <div class="card">
                    <h3>Comandas em Aberto</h3>
                    <div id="open-orders-grid" class="product-grid" style="margin-top: 20px;"></div>
                </div>
            </div>

            <div id="historico-tab" class="tab-pane">
                <div class="card">
                    <div style="display:flex; gap:10px; margin-bottom: 20px; align-items:center;">
                        <h3>Vendas do Dia</h3>
                        <input type="date" id="history-date" class="input-modern" style="width: auto; margin:0;">
                        <button id="export-daily-pdf" class="btn-sec">üñ®Ô∏è Relat√≥rio Di√°rio</button>
                    </div>
                    <div class="history-list" id="sales-history"></div>
                    <div style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 12px; text-align: right;">
                        <div style="font-size: 1.2rem;">Total Vendas: <strong id="history-grand-total">R$ 0.00</strong></div>
                    </div>
                </div>
            </div>

            <div id="despesas-tab" class="tab-pane">
                <div class="card">
                    <h3>Lan√ßar Despesa</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-top: 15px;">
                        <input type="text" id="new-expense-name" class="input-modern" placeholder="Motivo">
                        <input type="text" id="new-expense-desc" class="input-modern" placeholder="Detalhes">
                        <input type="number" id="new-expense-value" class="input-modern" placeholder="Valor R$">
                        <button id="add-new-expense-btn" class="btn-main" style="background: var(--danger); margin-top:0;">Lan√ßar</button>
                    </div>
                    <h3 style="margin-top:30px;">Hist√≥rico Despesas</h3>
                    <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
                        <input type="date" id="expense-date" class="input-modern" style="width: auto;">
                        <button id="export-expenses-pdf" class="btn-sec">üìÑ PDF</button>
                    </div>
                    <div id="expenses-history-list" style="margin-top:10px;"></div>
                    <div style="text-align: right; color: var(--danger); font-weight: bold; font-size: 1.2rem; margin-top:10px;">Total: <span id="expenses-total-today">R$ 0.00</span></div>
                </div>
            </div>

            <div id="admin-tab" class="tab-pane">
                 <div class="card promo-card">
                    <div class="switch-wrapper">
                         <h3 style="flex:1; color: #F57F17;">‚ö° Configurar Promo√ß√£o</h3>
                         <label class="toggle-switch">
                            <input type="checkbox" id="discount-active-check">
                            <span class="slider"></span>
                         </label>
                    </div>
                    <div id="discount-config-area" style="opacity: 0.5; pointer-events: none; display:flex; gap:15px; align-items:center;">
                        <input type="number" id="discount-percentage" class="input-modern" value="10" style="width: 80px; margin:0;">
                        <span>% OFF em:</span>
                        <label><input type="checkbox" id="discount-target-acai"> A√ßa√≠</label>
                        <label><input type="checkbox" id="discount-target-sorvete"> Sorvete</label>
                        <button id="save-discount-config" class="btn-sec" style="margin-left:auto;">Salvar</button>
                    </div>
                 </div>

                 <div class="card" style="margin-top:20px;">
                     <div id="admin-controls-panel">
                         <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                             <span>Painel Administrativo</span>
                             <button id="logout-btn" class="btn-sec" style="color:var(--danger); border-color:var(--danger);">Sair do Sistema</button>
                         </div>
                         <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                             <div>
                                 <h4>Pre√ßos Base (KG)</h4>
                                 <label>A√ßa√≠ R$</label>
                                 <input type="number" id="admin-acai-price" class="input-modern">
                                 <label>Sorvete R$</label>
                                 <input type="number" id="admin-sorvete-price" class="input-modern">
                                 <button id="save-base-prices" class="btn-main">Atualizar Pre√ßos</button>
                                 
                                 <h4 style="margin-top:20px;">Relat√≥rios</h4>
                                 <input type="month" id="report-month-select" class="input-modern">
                                 <button id="generate-monthly-report" class="btn-sec" style="width:100%;">üìÑ Gerar PDF Mensal</button>
                             </div>
                             <div>
                                 <h4>Log de Atividades</h4>
                                 <div class="log-container" id="system-log-container"></div>
                             </div>
                         </div>
                     </div>
                 </div>
            </div>

        </div>
    </main>

    <div id="notification" class="toast"><span class="toast-msg">Msg</span></div>

    <div id="product-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="prod-modal-title">Novo Produto</h3>
            <input type="hidden" id="prod-id">
            <input id="prod-name" class="input-modern" placeholder="Nome do Produto">
            <input id="prod-price" type="number" class="input-modern" placeholder="Pre√ßo (R$)">
            <select id="prod-category-select" class="input-modern">
                <option value="">Selecione ou digite abaixo...</option>
                <option value="Bebidas">Bebidas</option>
                <option value="Adicionais">Adicionais</option>
                <option value="Supra">Supra</option>
                <option value="Original">Original</option>
                <option value="Vita">Vita</option>
                <option value="Vita Whey">Vita Whey</option>
                <option value="Pardal Livre- Zero Lac">Pardal Livre- Zero Lac</option>
                <option value="Cl√°ssicos">Cl√°ssicos</option>
                <option value="Fun">Fun</option>
                <option value="Fun Zero Lac">Fun Zero Lac</option>
            </select>
            <input id="prod-category" class="input-modern" placeholder="Nova Categoria (se n√£o listada acima)">
            <input id="prod-image" class="input-modern" placeholder="URL da Imagem">
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button id="close-prod-modal" class="btn-sec" style="flex:1;">Cancelar</button>
                <button id="save-prod-btn" class="btn-main" style="flex:1; margin-top:0;">Salvar</button>
            </div>
            <button id="delete-prod-btn" class="btn-sec" style="width:100%; margin-top:10px; color:var(--danger); border-color:var(--danger); display:none;">Excluir Produto</button>
        </div>
    </div>

    <div id="details-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="details-title">Detalhes</h3>
            <div id="details-content" style="max-height: 300px; overflow-y: auto; margin: 15px 0; border-top: 1px dashed #ccc; border-bottom: 1px dashed #ccc; padding: 10px 0;"></div>
            <div style="display:flex; gap:10px;">
                 <button id="details-close-btn" class="btn-sec">Fechar</button>
                 <button id="details-reprint-btn" class="btn-sec">üñ®Ô∏è Reimprimir</button>
                 <button id="details-delete-btn" class="btn-main" style="background:var(--danger); margin-top:0;">Excluir</button>
            </div>
        </div>
    </div>

    <div id="hold-sale-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>Adicionar √† Comanda</h3>
            <label>Nova Comanda:</label>
            <input type="text" id="customer-name" class="input-modern" placeholder="Nome do Cliente">
            <div style="text-align:center; margin:10px 0;">OU</div>
            <label>Adicionar em Existente:</label>
            <select id="existing-order-select" class="input-modern"></select>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button id="close-hold-sale-btn" class="btn-sec">Cancelar</button>
                <button id="save-hold-sale-btn" class="btn-main" style="margin-top:0;">Salvar</button>
            </div>
        </div>
    </div>

    <div id="open-order-modal" class="modal-overlay">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 id="open-order-title">Comanda</h3>
                <span id="open-order-timer" class="badge">00:00</span>
            </div>
            <button id="add-cart-to-open-order-btn" class="btn-sec" style="width:100%; margin-bottom:15px; border:1px dashed var(--primary); color: var(--primary);">‚úèÔ∏è Editar / Adicionar Itens</button>
            <div id="open-order-items-list" style="max-height: 200px; overflow-y: auto; border-bottom: 1px dashed #ddd; margin-bottom:15px;"></div>
            <div style="text-align:right; font-size:1.4rem; color:var(--primary); font-weight:bold;">Total: <span id="open-order-total">R$ 0.00</span></div>
            
            <h4 style="margin-top:15px;">Pagamento</h4>
            <div class="payment-grid" id="open-order-payment-options">
                <div class="pay-opt" data-method="cash">üíµ Dinheiro</div>
                <div class="pay-opt" data-method="card">üí≥ Cart√£o</div>
                <div class="pay-opt" data-method="pix">üí† PIX</div>
            </div>
            <div id="open-order-cash-input" style="display:none; margin-top:10px;">
                <input type="number" id="oo-cash-received" class="input-modern" placeholder="Recebido">
                <div style="text-align:right;">Troco: <span id="oo-change">0.00</span></div>
            </div>
            
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button id="close-open-order-btn" class="btn-sec">Fechar</button>
                <button id="confirm-open-order-payment" class="btn-main" style="margin-top:0;">Receber / Finalizar</button>
            </div>
            
            <button id="cancel-open-order-btn" class="btn-sec" style="width:100%; margin-top:15px; border-color:var(--danger); color:var(--danger);">üö´ Cancelar Comanda</button>
        </div>
    </div>

    <div id="password-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="password-modal-title">Senha Necess√°ria</h3>
            <input type="password" id="general-password-input" class="input-modern" style="text-align:center; font-size:1.5rem; letter-spacing:5px;" placeholder="****">
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button id="cancel-password-btn" class="btn-sec">Cancelar</button>
                <button id="confirm-password-btn" class="btn-main" style="background:var(--primary); margin-top:0;">Confirmar</button>
            </div>
        </div>
    </div>

    <div id="global-loading" class="loading-overlay"><div class="spinner"></div></div>

    <script type="module" src="./src/main.js"></script>
</body>
</html>